{% extends 'base.html.twig' %}

{% block title %}Event - {{ event.title }}{% endblock %}

{% block body %}
    <h1>{{ event.title }}</h1>

    <div id="chat-messages">
        {% for message in chatMessages %}
            <div class="message">
                <strong>{{ message.sender }}</strong>: {{ message.message }}
            </div>
        {% endfor %}
    </div>

    <form id="chat-form" method="post" action="{{ path('app_event', {'eventId': event.id}) }}">
        {{ form_widget(chatForm.message) }}
        {{ form_widget(chatForm.submit) }}
    </form>

    <script>
        // Intercepter la soumission du formulaire de chat
        document.getElementById('chat-form').addEventListener('submit', function (e) {
            e.preventDefault(); // Empêcher le rechargement de la page

            // Récupérer le message à partir du champ de texte
            var messageInput = document.getElementById('chat_message');
            var message = messageInput.value;

            // Envoyer le message au serveur via une requête AJAX
            var xhr = new XMLHttpRequest();
            xhr.open('POST', this.action);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onload = function () {
                if (xhr.status === 200) {
                    // Ajouter le nouveau message à l'affichage des messages du chat
                    var chatMessagesDiv = document.getElementById('chat-messages');
                    var newMessageDiv = document.createElement('div');
                    newMessageDiv.classList.add('message');
                    newMessageDiv.innerHTML = '<strong>{{ currentUser }}</strong>: ' + message;
                    chatMessagesDiv.appendChild(newMessageDiv);

                    // Effacer le champ de texte
                    messageInput.value = '';
                }
            };
            xhr.send('chat_message=' + encodeURIComponent(message));
        });
    </script>
{% endblock %}

